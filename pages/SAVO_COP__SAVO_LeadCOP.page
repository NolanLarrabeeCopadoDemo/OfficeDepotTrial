<apex:page standardController="Lead" extensions="SAVO_COP.SAVO_COPController">
<apex:stylesheet value="{! URLFOR($Resource.SAVO_COPStyles, 'salesforce.opportunity.css')} "/>
<apex:includeScript value="{!URLFOR($Resource.SAVO_COP__SAVO_COPScripts, 'jquery-1.8.2.js')}"  />
<apex:includeScript value="{!URLFOR($Resource.SAVO_COP__SAVO_COPScripts, 'postmessage.js')}"  />

<script>
    $j = jQuery.noConflict();
    window.onload = loadIframe;

    var topProtocol = window.location.protocol;
    var topHost = window.location.host;
    var leadId = '{!objLead.Id}';
    var organizationId = '{!$Organization.Id}';
    var ifrm = null, sectionHeight = 0;
    var params;
    function loadIframe()
    {
        sectionHeight = $j(window).innerHeight();
        sectionHeight = (!sectionHeight || sectionHeight === 0) ? 400 : sectionHeight;
        
        ifrm = document.getElementById('widgetCOPiFrame');       
        var jsonParam = {integration: 'Salesforce', organizationId: organizationId, objectType:'Lead', objectId:leadId};
        params = 'contextParams='+JSON.stringify(jsonParam);
        
        var sessionId =  '{!$Api.Session_ID}';
        var serverUrl = '{!$Api.Partner_Server_URL_290}';

        var returnUrl = '{!PlatformUrl}' + '/Chromeless/Integration/Widgets/GetWidgets?'+params;     
        var ssoUrl = '{!ClassicUrl}' + '/SingleSignOn/Salesforce.ashx?absolute=y&sessionid='+sessionId+'&url='+serverUrl+'&returnurl='+returnUrl;
        
        ifrm.setAttribute("src", ssoUrl );
    }  
        
    pm.bind("reloadCOP", function(data) {            
      loadIframe();
    }, 
    '{!PlatformUrl}');      
       
</script>
    <div> 
        <iframe id="widgetCOPiFrame" name="iFrameCOP" frameborder="0" height="400px" class="coplistframe">
        </iframe>        
    </div>
</apex:page>